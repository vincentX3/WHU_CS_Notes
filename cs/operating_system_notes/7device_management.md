# è®¾å¤‡ç®¡ç†
> å¸¸ç”¨çš„è®¾å¤‡ï¼Œå¯æ„ŸçŸ¥çš„è¯¸å¦‚é¼ æ ‡ã€é”®ç›˜ã€æ˜¾ç¤ºå™¨ã€ç£ç›˜ï¼›
> è¿˜æœ‰é‚£äº›ä¸æ˜“å‘è§‰çš„ï¼Œå¦‚**ç½‘å¡ã€æ—¶é’Ÿ**ç­‰ã€‚
> æ“ä½œç³»ç»Ÿå¤§å°çš„å¢é•¿ï¼Œä¸€éƒ¨åˆ†æºäºå„ç§è®¾å¤‡çš„å‡ºç°â€”â€”éœ€è¦å¯¹åº”çš„æ¥å£ä¸ç®¡ç†ï¼ˆ**driveré©±åŠ¨**ï¼‰
> æ–°è®¾å¤‡çš„å‡ºç°ï¼Œéœ€è¦å‚å•†æä¾›æ“ä½œç³»ç»Ÿæ”¯æŒçš„é©±åŠ¨ã€‚


## 1. æ¦‚è¿°
### 1.1 åˆ†ç±»
1. æŒ‰ç‰¹æ€§
    - å­˜å‚¨ï¼ˆe.g.ç£ç›˜ã€ç£å¸¦ï¼‰
    - I/Oè®¾å¤‡
2. æŒ‰å…±äº«å±æ€§
    - ç‹¬å è®¾å¤‡
        > ä¸€æ®µæ—¶é—´å†…ï¼Œåªå…è®¸**ä¸€ä¸ªç”¨æˆ·**
    - å…±äº«è®¾å¤‡
        > **ä¸€æ®µæ—¶é—´**å…è®¸å¤šä¸ªè¿›ç¨‹ä½¿ç”¨ï¼ˆe.g. å¤–å­˜)
    - è™šæ‹Ÿè®¾å¤‡
        > æ”¹é€ ç‹¬å è®¾å¤‡ä¸º**é€»è¾‘è™šæ‹Ÿè®¾å¤‡**ã€‚
3. æŒ‰**ä¿¡æ¯äº¤æ¢å•ä½**
    - å—è®¾å¤‡ï¼ˆéœ€è¦**å¯»å€**ï¼‰
    - å­—ç¬¦è®¾å¤‡ï¼ˆæ— éœ€å¯»å€ï¼‰

### 1.2 ä»»åŠ¡&åŠŸèƒ½
- ä»»åŠ¡ï¼š
å¯ç”¨ï¼š1. å“åº”ç”¨æˆ·è®¾å¤‡è¯·æ±‚ 2. åˆ†é…è®¾å¤‡
å¥½ç”¨ï¼š1. æé«˜è®¾å¤‡åˆ©ç”¨ç‡ 2.æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨

- åŠŸèƒ½ï¼š
    1. è®¾å¤‡åˆ†é…ï¼ˆé€šé“-æ§åˆ¶å™¨-è®¾å¤‡ï¼‰
    2. è®¾å¤‡å¤„ç†
    3. ç¼“å†²ç®¡ç†ï¼ˆç¼“å’ŒCPUã€I/Oé€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ï¼‰
    4. è®¾å¤‡ç‹¬ç«‹æ€§ï¼ˆé€»è¾‘è®¾å¤‡**æ˜ å°„ä¸º**ç‰©ç†è®¾å¤‡ï¼‰

### 1.3 è®¾å¤‡æ§åˆ¶å™¨&é€šé“
#### è®¾å¤‡æ§åˆ¶å™¨
defï¼š
åŠŸèƒ½ï¼š
1. è¯†åˆ«ã€æ¥å—CPUå‘½ä»¤
2. ç”¨æ•°æ®å¯„å­˜å™¨ã€æ˜¾å­˜ç­‰å®ç°**æ•°æ®äº¤æ¢**
3. ç”¨çŠ¶æ€å¯„å­˜å™¨å‘CPUæä¾›è®¾å¤‡çŠ¶æ€æŸ¥è¯¢
4. åœ°å€è¯†åˆ«

#### I/Oé€šé“ channel
ä»æ˜¯**å¤„ç†æœº**
- åˆ†ç±»
    1. å­—èŠ‚å¤šè·¯ï¼ˆä½é€Ÿã€å…±äº«ï¼‰
    2. æ•°æ®é€‰æ‹©ï¼ˆé«˜é€Ÿï¼Œç‹¬å ï¼‰
    3. æ•°æ®å¤šè·¯

### 1.4 I/Oç³»ç»Ÿç»“æ„
1. å¾®å‹æœº
**æ€»çº¿I/Oç³»ç»Ÿç»“æ„**ï¼ˆPCIæ ‡å‡†ï¼‰
> å¾®æœºè®¾å¤‡ä¸å¤šï¼Œæ€»çº¿èƒ½æ»¡è¶³éœ€æ±‚ã€‚ï¼ˆä¸»æ¿ä¸Šæ€»çº¿+æ’æ§½ï¼‰
â€œè½¦è¾†ä¸å¤šï¼Œä¸€æ¡å¤§é©¬è·¯è¶³ä»¥ã€‚â€

![](./images/7bus.png)
2. ä¸»æœºå‹
**ä½¿ç”¨I/Oé€šé“**ï¼ˆé€šé“ä»·æ ¼è´µå“¦ï¼Œæ— æ³•å¸ƒç½®è®¸å¤šï¼‰
- å•é€šé“ï¼ˆå­˜åœ¨**ç“¶é¢ˆ**ç°è±¡ï¼‰
- å¤šé€šé“
![](./images/7channel.png)
## 2. I/Oæ§åˆ¶æ–¹å¼
### 2.1 ç¨‹åºç›´æ¥æ§åˆ¶
å³**è½®è¯¢**
æ—©æœŸè®¡ç®—æœºæ— ä¸­æ–­æœºæ„ï¼Œé‡‡ç”¨è½®è¯¢ã€‚ç°ä»Šè®¡ç®—æœºå‘ä¸‹å…¼å®¹ï¼Œä»å¯è½®è¯¢ã€‚æ­¤å¤–ï¼Œéƒ¨åˆ†ç®€å•åµŒå…¥å¼ç³»ç»Ÿä¹Ÿä½¿ç”¨è½®è¯¢ã€‚
### 2.2 ä¸­æ–­æ§åˆ¶
ä»¥**å­—èŠ‚**ä¸ºå•ä½ä¸­æ–­CPU
> ç”±è®¾å¤‡æè¯·æ±‚ğŸ‘‰æé«˜CPUä¸è®¾å¤‡**å¹¶è¡Œ**å·¥ä½œç¨‹åº¦

é€‚åˆ**å­—ç¬¦**è®¾å¤‡
> å—è®¾å¤‡æ•°æ®ä¼ è¾“è¾ƒå¿«ã€‚å“åº”ä¸­æ–­æ—¶é—´ç­‰äºç”šè‡³å¤§äºå…¶å­—èŠ‚ä¼ è¾“çš„é€Ÿåº¦
### 2.3 DMAæ§åˆ¶
æ€æƒ³ï¼šå¼€è¾Ÿç›´æ¥çš„æ•°æ®äº¤æ¢é€šè·¯ï¼Œå‡å°‘ä¸­æ–­ã€‚
é€‚ç”¨äº**å—è®¾å¤‡**æ•°æ®ä¼ è¾“
registerè¦æ±‚ï¼š
1. CR å‘½ä»¤/çŠ¶æ€å¯„å­˜å™¨
2. MAR å†…å­˜åœ°å€å¯„å­˜å™¨ï¼šå†…å­˜èµ·å§‹åœ°å€
3. DR æ•°æ®å¯„å­˜å™¨ï¼šdata
4. DC æ•°æ®è®¡æ•°å™¨ï¼šIOå­—èŠ‚æ•°

### 2.4 é€šé“æ§åˆ¶
![](./images/7channel_procedure.png)

## 3. ä¸­æ–­
### 3.1 åè¯
- æ–­ç‚¹
- æ¢å¤ç‚¹
- ç°åœº
- ç¨‹åºçŠ¶æ€å­—
- ä¸­æ–­æº/ä¸­æ–­è¯·æ±‚/ä¸­æ–­å“åº”
- å¼€/å…³ä¸­æ–­ï¼Œå±è”½ä¸­æ–­
### 3.2 å¤„ç†è¿‡ç¨‹
1. ç°åœºä¿æŠ¤
2. æ‰§è¡Œå¯¹åº”ä¸­æ–­å¤„ç†ç¨‹åº
3. æ¢å¤ç°åœº

## 4.ç¼“å†²
### 4.1 å¼•å…¥
- å¼•å…¥åŸå› 
    1. ç¼“å’Œé€Ÿåº¦ä¸åŒ¹é…çŸ›ç›¾
    2. æé«˜å¹¶è¡Œæ“ä½œç¨‹åº¦
    3. å‡å°‘ä¸­æ–­é¢‘ç‡
        >æ— ç¼“å†²ï¼Œäº§ç”Ÿ1å­—èŠ‚ï¼Œå‘1ä¸­æ–­
        æœ‰ç¼“å†²ï¼Œç¼“å†²åŒº(e.g. 1024byte)æ»¡ï¼Œå‘1ä¸­æ–­
- å®ç°æ–¹æ³•
    - hardwareï¼šå¢åŠ Registersï¼Œæˆæœ¬é«˜
    - softwareï¼šå¼€è¾Ÿå†…å­˜åŒºåŸŸ

### 4.2 å•ç¼“å†²
![](./images/7single_buffer.png)
ä¸ºä½•èƒ½æå‡æ•ˆç‡ï¼ŸğŸ‘‰process & IO deviceï¼Œæå‡äº†**å¹¶è¡Œ**ç¨‹åº¦
Ex.
> è®¾IOç›´æ¥è¾“å…¥ç»™user processæ‰€éœ€æ—¶é—´ï¼š$T_1$
bufferä¼ é€ç»™user processæ‰€éœ€æ—¶é—´ï¼š$T_2$
ç”¨æˆ·è¿›ç¨‹è¿ç®—æ‰€éœ€æ—¶é—´$T_3$
$$T_3>T_1>T_2$$
å½“IOæ‰§è¡Œ$N$æ¬¡æ—¶ï¼Œæœ‰ï¼š
$$N*(T_1+T_3)>N*T_3+m*T_2,m<<N$$

### 4.3 åŒç¼“å†²
![](./images/7double_buffer.png)
### 4.4 å¾ªç¯ç¼“å†²
![](./images/7circle_buffer.png)
- å•ã€åŒç¼“å†²å³å¾ªç¯ç¼“å†²çš„**ç‰¹ä¾‹**
- å†…å­˜åˆ©ç”¨ç‡ä¸é«˜ã€‚è¿›ç¨‹å¤šæ—¶åˆ›å»ºå¤šæ¡å¾ªç¯ç¼“å†²åŒºï¼Œå¼€é”€å¤§

### 4.5 ç¼“å†²æ± 
å½“ä¸‹ï¼Œå¸¸ä½¿ç”¨**å…¬å…±ç¼“å†²æ± **ã€‚ç”±å¤šä¸ªç¼“å†²åŒºç»„æˆï¼Œä¾›å¤šä¸ªè¿›ç¨‹**å…±äº«**ï¼Œèƒ½è¾“å…¥åˆèƒ½è¾“å‡ºã€‚ 
**å†…å«**ï¼š
1. ç¼“å†²é˜Ÿåˆ—
    - ç©ºç¼“å†²é˜Ÿåˆ—
    - è¾“å…¥é˜Ÿåˆ—ï¼ˆè£…**æ»¡**çš„è¾“å…¥ç¼“å†²åŒº
    - è¾“å‡ºé˜Ÿåˆ—ï¼ˆè£…**æ»¡**çš„è¾“å‡ºç¼“å†²åŒº
2. å·¥ä½œç¼“å†²åŒº
    - æ”¶å®¹è¾“å…¥æ•°æ®
    - æå–è¾“å…¥æ•°æ®
    - æ”¶å®¹è¾“å‡ºæ•°æ®
    - æå–è¾“å‡ºæ•°æ®
    ğŸ‘†ğŸ‘†ğŸ‘†
    æå–å®Œåï¼ŒæŒ‚åˆ°ç©ºç¼“å†²é˜Ÿåˆ—
    æ”¶å®¹å®Œåï¼ŒæŒ‚åˆ°å¯¹åº”I/Oé˜Ÿåˆ—




### 5. è®¾å¤‡åˆ†é…
- data structure
    - è®¾å¤‡æ§åˆ¶è¡¨`DCT`ï¼ˆæè¿°è®¾å¤‡ä¿¡æ¯ï¼Œe.g. 
    - æ§åˆ¶å™¨æ§åˆ¶è¡¨`COCT` ï¼ˆçŠ¶æ€ã€åç§°ã€ç©ºé—²ä¸å¦
    - é€šé“æ§åˆ¶è¡¨`CHDT`
    - è®¾å¤‡è¡¨ï¼ˆä¸€ä¸ªç³»ç»Ÿä»…ä¸€ä¸ª)`SDT`

#### 5.1 åˆ†é…
è€ƒè™‘ï¼š
1. è®¾å¤‡ä½¿ç”¨æ€§è´¨ï¼ˆç‹¬å /å…±äº«/`è™šæ‹Ÿ`)
> è™šæ‹Ÿï¼šè®¾å¤‡æœ¬èº«è™½æ˜¯ç‹¬å è®¾å¤‡ï¼ŒSPOOLingæŠ€æœ¯å¤„ç†åæ”¹é€ æˆè™šæ‹Ÿè®¾å¤‡
2. åˆ†é…ç®—æ³•
    - å…ˆæ¥å…ˆæœåŠ¡
    - é«˜ä¼˜å…ˆçº§
3. å®‰å…¨æ€§
ä¿è¯ä¸å‘ç”Ÿè¿›ç¨‹æ­»é”ã€‚ï¼ˆreviewï¼‰
    - `é™æ€åˆ†é…`ï¼šæ— æ­»é”ï¼Œä¸€æ¬¡æ€§å…¨éƒ¨åˆ†é…ã€‚ä½æ•ˆã€‚
    - `åŠ¨æ€åˆ†é…`ï¼šæŒ‰éœ€åˆ†é…
4. ç‹¬ç«‹æ€§
è¿›è¡Œ**é€»è¾‘è®¾å¤‡**çš„æŠ½è±¡ã€‚
å®ç°ï¼šå¯ç”¨`é€»è¾‘è®¾å¤‡è¡¨`ğŸ‘ˆä½ çˆ±å«å•¥å«å•¥ï¼Œåæ­£æ˜¯å®ç°ä¸€ä¸ª**æ˜ å°„**

### 5.3 è®¾å¤‡åˆ†é…
åˆ†é…è®¾å¤‡ --> åˆ†é…æ§åˆ¶å™¨ --> åˆ†é…é€šé“

#### 5.4 SPOOLING ç³»ç»Ÿ
> backgroundï¼š
ç‹¬å è®¾å¤‡æ•°é‡å°‘ï¼Œè®¸å¤šè¿›ç¨‹å› ç­‰å¾…å…¶åˆ†é…è€Œé˜»å¡

Simultaneous Peripheral Operations On-Line
ç‹¬å è®¾å¤‡ -->æ”¹é€ --> å…±äº«è®¾å¤‡

![](./images/7spooling.png)
- ç»„æˆï¼š
    - `è¾“å…¥/è¾“å‡ºäº•`
    - è¾“å…¥/è¾“å‡ºç¼“å†²åŒº
    - è¾“å…¥/è¾“å‡ºè¿›ç¨‹


### 6. I/Oè½¯ä»¶å±‚æ¬¡ç»“æ„
![](./images/7IOhierachy.png)

