# å­˜å‚¨å™¨ç®¡ç†

## 0. å¼•å…¥
> æ”¹é©å¼€æ”¾æ˜¥é£Žå¹æ»¡åœ°ï¼Œäººæ°‘æ‰‹å¤´é’±å¤šäº†ï¼Œä½†äººä»¬æ²¡æœ‰æ„Ÿåˆ°æš´å¯Œã€‚å› ä¸ºç‰©è´¨éœ€æ±‚åŒæ—¶ä¹Ÿåœ¨å¢žé•¿ã€‚

ðŸ‘†å­˜å‚¨å™¨ç®¡ç†ä¹Ÿæ˜¯è¿™èˆ¬ã€‚çºµç„¶å­˜å‚¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå„ç§è½¯ä»¶æ‰€éœ€èµ„æºä¹ŸåŒæ—¶è†¨èƒ€ã€‚so å¯¹å­˜å‚¨å™¨ç®¡ç†ï¼Œå°±æ˜¯â€œç”¨å¥½æ‰‹å¤´çš„é’±ï¼Œæƒ³åŠžæ³•å¾—åˆ°æ›´å¤šçš„é’±â€ã€‚
å½“ç„¶ï¼Œä¹Ÿè¦ä»Žå‘å±•çš„çœ¼å…‰çœ‹å­˜å‚¨ç®¡ç†æ–¹å¼çš„è¿›æ­¥~

- å­˜å‚¨å™¨åˆ’åˆ†ï¼š
    ç³»ç»ŸåŒºï¼ˆOSç”¨ï¼‰ï¼ç”¨æˆ·åŒºï¼ˆå¯å¤šä¸ªï¼Œä¾›ç”¨æˆ·è¿›ç¨‹ç”¨ï¼‰

- åŠŸèƒ½ï¼š
    1. åˆ†é…&å›žæ”¶
    2. æŠ½è±¡&æ˜ å°„ï¼ˆé€»è¾‘åœ°å€â†’ç‰©ç†åœ°å€ï¼‰
    3. å†…å­˜æ‰©å…… ï¼ˆé€»è¾‘æ‰©å……ï¼‰
    4. å­˜å‚¨ä¿æŠ¤

## 1. åŸºæœ¬æ¦‚å¿µ
æºç¨‹åºâ†’å¯æ‰§è¡Œç¨‹åºï¼Œä¸€èˆ¬åŽ†ç»ï¼š
> 1ï¼‰ç¼–è¯‘ â†’ 2ï¼‰é“¾æŽ¥ â†’ 3ï¼‰è£…å…¥
### 1.1 ç¨‹åºè£…å…¥

#### ç»å¯¹è£…å…¥æ–¹å¼
ç¼–è¯‘æ—¶äº§ç”Ÿ**ç»å¯¹åœ°å€**çš„ç›®æ ‡ä»£ç ï¼Œè£…å…¥è¯¥åœ°å€
ï¼ˆé€»è¾‘åœ°å€==ç»å¯¹åœ°å€ï¼‰

*é€‚ç”¨äºŽå•é“ç¨‹åº*
#### å¯é‡å®šä½è£…å…¥æ–¹å¼
ç¼–è¯‘æ—¶äº§ç”Ÿ**é€»è¾‘åœ°å€**çš„ç›®æ ‡ä»£ç ï¼Œè£…å…¥æ—¶è¿›è¡Œ**åœ°å€æ˜ å°„**
- ç»å¯¹åœ°å€=é€»è¾‘åœ°å€ + ç¨‹åºåŸºåœ°å€
- åœ°å€å˜æ¢è½¬å…¥æ—¶**ä¸€æ¬¡å®Œæˆ**

ðŸ‘†ä¸€æ¬¡æ€§è£…å…¥ï¼Œå½“ç¨‹åºè¾ƒå¤§æ—¶ä»£ç åˆ©ç”¨çŽ‡ä½Žï¼Œè£…å…¥è¿‡å¤šâ€œçŸ­æ—¶é—´å†…â€ä¸ä½¿ç”¨çš„ä»£ç 
#### åŠ¨æ€è¿è¡Œæ—¶è£…å…¥æ–¹å¼
è£…å…¥å†…å­˜æ—¶ä¸åœ°å€å˜æ¢ï¼Œåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œåœ°å€å˜æ¢
- éœ€ç¡¬ä»¶æ”¯æŒ
- å¯**éƒ¨åˆ†**è£…å…¥
- å¯å°†ç¨‹åºåˆ†é…åˆ°**ä¸è¿žç»­**çš„å†…å­˜

### 1.2 ç¨‹åºé“¾æŽ¥
- **é™æ€é“¾æŽ¥**ï¼š
    è¿è¡Œå‰è£…é…ä¸ºå®Œæ•´è£…å…¥æ¨¡å—

- **è£…å…¥æ—¶åŠ¨æ€é“¾æŽ¥**ï¼š
    ç›®æ ‡æ¨¡å—åœ¨è£…å…¥å†…å­˜æ—¶**è¾¹è£…å…¥è¾¹é“¾æŽ¥**ã€‚
    ç‰¹ç‚¹ï¼šä¾¿äºŽè½¯ä»¶ç‰ˆæœ¬çš„ä¿®æ”¹å’Œæ›´æ–°ï¼Œä¾¿äºŽç›®æ ‡æ¨¡å—çš„å…±äº«
    ç¼ºç‚¹ï¼šä¸å¯é¢„çŸ¥è¦è¿è¡Œçš„æ¨¡å—ã€‚å¯¼è‡´æ¯æ¬¡è£…å…¥æ¨¡å—éƒ½**ç›¸åŒ**ï¼ˆä¿è¯å®Œæ•´ã€å¯ç”¨çš„å¦¥åï¼‰

- **è¿è¡Œæ—¶åŠ¨æ€é“¾æŽ¥**ï¼š
    **æ‰§è¡Œ**è¿‡ç¨‹ä¸­ï¼Œè‹¥å‘çŽ°è¢«è°ƒç”¨æ¨¡å—å°šæœªè£…å…¥å†…å­˜ï¼ŒOSæ‰è¿›è¡Œå¯»æ‰¾ã€è£…å…¥ã€é“¾æŽ¥è¯¥æ¨¡å—
    ç‰¹ç‚¹ï¼šåŠ å¿«ç¨‹åºè£…å…¥ï¼ŒèŠ‚çœå†…å­˜ã€‚


### 1.3 å†…å­˜ä¿æŠ¤

#### ç•Œé™ä¿æŠ¤
1. ä¸Šä¸‹ç•Œå¯„å­˜å™¨
2. åŸºå€ã€é™é•¿å¯„å­˜å™¨

#### è®¿é—®æ–¹å¼ä¿æŠ¤
é”ä¸Žé’¥åŒ™ï¼š
å­˜å‚¨å—ï¼š åˆ†é…ä¸“å±žä¿æŠ¤é”®ï¼ˆblockï¼‰
è¿›ç¨‹ï¼š èµ‹äºˆä¿æŠ¤é”®ï¼ˆkeyï¼‰

#### çŽ¯ä¿æŠ¤
åˆ’åˆ†**ç‰¹æƒçº§**
ï¼ˆOS kernelï¼š0çº§â€”â€”æœ€é«˜çº§ï¼‰

## 2. å•ä¸€è¿žç»­åˆ†é…
- ç‰¹ç‚¹:
    **é™æ€åˆ†é…**ï¼Œç®€å•ï¼Œå•ç”¨æˆ·ã€å•ä»»åŠ¡

- æ¥ç”±ï¼š
    æ—©æœŸå¾®å¤„ç†æœºå†…å­˜æœ‰é™ï¼Œå¤„ç†èƒ½åŠ›å·®ï¼Œæ— æ³•æ”¯æŒæ—¶åˆ†å¤ç”¨

- ç¼ºç‚¹ï¼š
    åªæ”¯æŒå•é“ä½œä¸šï¼Œèµ„æºåˆ©ç”¨çŽ‡ä½Ž

## 3. åˆ†åŒºå­˜å‚¨ç®¡ç†
terminologyï¼š
`å†…éƒ¨ç¢Žç‰‡`ï¼šInternal Fragmentï¼Œåˆ†é…ç»™ä½œä¸šçš„å­˜å‚¨ç©ºé—´ä¸­æœªè¢«åˆ©ç”¨çš„éƒ¨åˆ†
`å¤–éƒ¨ç¢Žç‰‡`ï¼šExternal Fragmentï¼Œç³»ç»Ÿä¸­æ— æ³•åˆ©ç”¨çš„å°å­˜å‚¨å—
### 3.1 å›ºå®šåˆ†åŒº
- what
    å†…å­˜ç©ºé—´åˆ’åˆ†ä¸º**å¤§å°ä¸ç­‰**è‹¥å¹²åŒºåŸŸä¾›ç¨‹åºè£…å…¥è¿è¡Œï¼Œä½ç½®ä¸Žå¤§å°**è¿è¡ŒæœŸé—´ä¸å˜**
- data structure
    å»ºç«‹`åˆ†åŒºè¯´æ˜Žè¡¨`ï¼ˆç»“æž„ä½“æ•°ç»„ï¼‰
    ```
    struct regions_info{
        int no;          //åˆ†åŒºå·
        int size;        //åˆ†åŒºå¤§å°
        int beginAddress;//èµ·å§‹åœ°å€
        bool status;     //çŠ¶æ€ï¼šæ˜¯å¦åˆ†é…
    }
    ```
- disadvantages:
    ä¸ºä¿è¯ç¨‹åºå¯è£…å…¥ï¼Œ$RegionSize >= ProgrammeSize$
    å› ä¸ºäº‹å…ˆå›ºå®šåˆ†åŒºå¤§å°ï¼Œå¯¹ç¨‹åºâ€œå®šåˆ¶æ€§â€ä½Žï¼Œå¯¼è‡´**åˆ†åŒºå†…**å­˜åœ¨`å†…éƒ¨ç¢Žç‰‡`ï¼Œå†…å­˜åˆ©ç”¨çŽ‡ä½Ž

### 3.2 åŠ¨æ€åˆ†åŒºç®¡ç†
- what
    ä½œä¸šè£…å…¥å†…å­˜æ—¶ï¼Œæ ¹æ®å…¶å¤§å°**åŠ¨æ€*å»ºç«‹åˆ†åŒº

- data structure
    - ç©ºé—²åˆ†åŒºè¡¨ï¼ˆä¸åˆé€‚ï¼‰
    - ç©ºé—²åˆ†åŒºé“¾

butï¼éšåˆ†åŒºçš„å»ºç«‹ä¸Žé‡Šæ”¾ï¼Œ**åˆ†åŒºé—´**äº§ç”Ÿ`å¤–éƒ¨ç¢Žç‰‡`ï¼Œéœ€è¦è®¾è®¡**åŠ¨æ€åˆ†åŒºåˆ†é…ä¸Žå›žæ”¶æœºåˆ¶**

#### åˆ†åŒºåˆ†é…ç®—æ³•
- **é¦–æ¬¡é€‚åº”ç®—æ³•**
    first fit
    åˆ†åŒºè¦æ±‚ï¼šåœ°å€é€’å¢ž 
    ç­–ç•¥ï¼šæ¯æ¬¡ä½œä¸šè¦æ±‚ï¼Œä»Žå¤´æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³å¤§å°çš„åˆ†åŒº
    ç‰¹ç‚¹ï¼š
        1. ä¿ç•™é«˜åœ°å€çš„**å¤§ç©ºé—²åŒº**
        2. æ¯æ¬¡æŸ¥æ‰¾ä»Žå¤´å¼€å§‹â†’æŸ¥æ‰¾å¼€é”€å¤§
        3. ä½Žåœ°å€ä¸æ–­è¢«åˆ’åˆ†â†’äº§ç”Ÿè®¸å¤šç»†å°çš„ç©ºé—²åˆ†åŒº
        
- **å¾ªçŽ¯é¦–æ¬¡é€‚åº”**
    first fitæ¼”å˜ã€‚æ–°çš„ä½œä¸šè¦æ±‚ï¼Œä»Žä¸Šæ¬¡æŸ¥æ‰¾çš„ç©ºé—²åˆ†åŒºä¸‹ä¸€ä¸ªå¼€å§‹
    ç‰¹ç‚¹ï¼šç©ºé—´**åˆ©ç”¨å‡è¡¡**/ç¼ºå°‘å¤§åˆ†åŒº
- **æœ€ä½³é€‚åº”**
    best fit
    åˆ†åŒºè¦æ±‚ï¼šå®¹é‡é€’å¢ž
    ç­–ç•¥ï¼šæ‰¾ç¬¬ä¸€ä¸ªåˆé€‚å¤§å°çš„ç©ºé—²åŒº
    ç‰¹ç‚¹ï¼š
        1. æ‰€åˆ’åˆ†çš„ç©ºé—²åˆ†åŒºå¤§å°ä¸Žä½œä¸šè¦æ±‚**æœ€ä¸ºæŽ¥è¿‘**
        2. ç•™ä¸‹è¾ƒå¤šéš¾åˆ©ç”¨çš„å°ç©ºé—²åˆ†åŒº
- **æœ€åé€‚åº”**
    worst fit
    åˆ†åŒºè¦æ±‚ï¼šå®¹é‡é€’å‡
    ç­–ç•¥ï¼šæ¯”å¯¹æœ€å¤§ç©ºé—²åˆ†åŒºï¼Œæ»¡è¶³ä½œä¸šè¦æ±‚åˆ™åˆ’åˆ†ï¼Œå¦åˆ™å¤±è´¥
    ç‰¹ç‚¹ï¼š
        1. **åˆ†é…è¿…é€Ÿ**ï¼Œ1æ¬¡æ¯”å¯¹å³å†³å®šèƒ½å¦åˆ†é…
        2. å¯¹å¤§ç©ºé—²åˆ†åŒºä¸æ–­åˆ’åˆ†ï¼Œå¸¸ä¸èƒ½æ»¡è¶³**å¤§ä½œä¸šçš„ç”³è¯·**

#### åˆ†åŒºå›žæ”¶
ä¸ŽçŽ°æœ‰ç©ºé—²åˆ†åŒºå…³ç³»ï¼šï¼ˆé€šè¿‡å¯¹é¦–åœ°å€ã€åˆ†åŒºå¤§å°è¿ç®—åˆ¤æ–­ï¼‰
    1. ä¸Šç›¸é‚»
    2. ä¸‹ç›¸é‚»
    3. ä¸Šä¸‹ç›¸é‚»
    4. ä¸ç›¸é‚»
    > `é¦–æ¬¡é€‚åº”/å¾ªçŽ¯é¦–æ¬¡é€‚åº”`ä¸ç”¨è°ƒæ•´`ç©ºé—²åˆ†åŒºé“¾`
    >  `æœ€å¥½/æœ€åé€‚åº”` éœ€è¦æŒ‰æ–°ç©ºé—²åˆ†åŒºå¤§å°è°ƒæ•´`ç©ºé—²åˆ†åŒºé“¾`

#### å¯é‡å®šä½åˆ†åŒºåˆ†é…
åŠ¨æ€åˆ†åŒºï¼Œä¼šäº§ç”Ÿ`å¤–éƒ¨ç¢Žç‰‡`ï¼Œéœ€è¦å¯¹è¿™äº›å­˜å‚¨å¿«è¿›è¡Œæ•´ç†ã€åˆ©ç”¨
- æ‹¼æŽ¥ Compaction
    æŠ€æœ¯éš¾ç‚¹ï¼š
    > 1. éœ€è¦`åŠ¨æ€é‡å®šä½`æŠ€æœ¯ï¼Œ è®°å½•æ‹¼æŽ¥åŽçš„**ä½ç½®**
    > 2. ç§»åŠ¨åˆ°å“ªï¼Ÿ è¯„ä¼°ç¢Žç‰‡ç§»åŠ¨åˆ°ä¸åŒä½ç½®çš„å¼€é”€
    > 3. ä½•æ—¶ç§»åŠ¨ï¼Ÿå¤šä¹…ä¸€æ¬¡ï¼Ÿ é«˜é¢‘â†’å¢žæ·»ç³»ç»Ÿå¼€é”€ï¼›ä½Žé¢‘â†’å†…å­˜å¯èƒ½ç´§å¼ 

- ç®—æ³•æè¿°
ï¼ˆåŠ¨æ€åˆ†åŒº+æ‹¼æŽ¥å°”å°”â€”â€”)
![](./images/5compaction.png)

### 4. ä¼™ä¼´ç³»ç»Ÿ buddy system
Elegantï¼äºŒè¿›åˆ¶çš„èˆžè¹ˆï¼LinuxðŸ‚ðŸº

- ç®—æ³•æè¿°
$$Initial Space:2^m$$
$$Requested Spaceï¼šn ,which (2^{i-1}\leq n\leq 2^i)$$
```pseudo
if system exist size(i) block
    dispatch it to application
else{
    if we have size(j) block, j>i{
        do{
            equally divide space,
            j--,
            we get two size (j-1) block
        }when(j==i)
        dispatch the generated size(i) block to application
    }
    else
        request failed
} 
``` 